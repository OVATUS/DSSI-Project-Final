{# templates/boards/components/popup_task_form.html #}

<div
  x-cloak
  x-show="taskModalOpen"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
  x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
  x-transition:leave="transition ease-in duration-150"
  x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
  x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
  class="fixed inset-0 z-60 flex items-center justify-center p-4 sm:p-6"
>
  {# 1. Backdrop (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î) #}
  <div
    class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity"
    @click="taskModalOpen = false"
  ></div>

  {# 2. Modal Panel #}
  <div
    class="relative w-full max-w-6xl bg-white rounded-2xl shadow-2xl overflow-hidden transform transition-all flex flex-col max-h-[90vh]"
    @click.stop
  >
    {# --- HEADER --- #}
    <div class="px-6 py-4 border-b border-gray-100 flex items-start justify-between bg-gray-50/50 flex-shrink-0">
      <div class="space-y-1">
        <h3 class="text-sm font-medium text-gray-500 flex items-center gap-2">
          <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏•‡∏¥‡∏™‡∏ï‡πå:</span>
          <span
            x-text="taskListTitle"
            class="bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide"
          ></span>
        </h3>
        <div class="text-xs text-gray-400">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</div>
      </div>

      <button
        type="button"
        class="text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-2 rounded-full transition-colors"
        @click="taskModalOpen = false"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    {# --- BODY (Grid 2 Columns) --- #}
    <div class="flex-1 overflow-y-auto p-6 bg-white">
      <div class="grid grid-cols-1 lg:grid-cols-[3fr,1fr] gap-8 h-full">
        
        {# ========================================== #}
        {# üìù ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢: FORM & DETAILS #}
        {# ========================================== #}
        <div>
          <form id="taskForm" method="post" :action="taskActionUrl" class="space-y-8">
            {% csrf_token %}

            {# --- 1. ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô (Task Title) --- #}
            <div>
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-indigo-500 text-lg">üìã</span>
                    <h4 class="font-bold text-gray-800 text-sm uppercase tracking-wide">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô</h4>
                </div>
                <input
                    type="text"
                    name="title"
                    x-model="taskTitle"
                    class="w-full text-xl font-bold text-gray-800 placeholder-gray-400 border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 bg-gray-50/30 hover:bg-white transition-colors"
                    placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏î..."
                    required
                />
            </div>

            {# --- 2. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Description) --- #}
            <div>
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-indigo-500 text-lg">üìù</span>
                    <h4 class="font-bold text-gray-800 text-sm uppercase tracking-wide">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h4>
                </div>
                <textarea
                    name="description"
                    x-model="taskDescription"
                    rows="4"
                    class="w-full text-sm text-gray-700 border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 px-4 py-3 bg-gray-50/30 hover:bg-white transition-colors placeholder-gray-400"
                    placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô..."
                ></textarea>
            </div>

            {# --- 3. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå (Checklist) - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô Edit --- #}
            <div x-show="taskMode === 'edit'">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <span class="text-indigo-500 text-lg">‚òëÔ∏è</span>
                        <h4 class="font-bold text-gray-800 text-sm uppercase tracking-wide">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå</h4>
                    </div>
                    <span class="text-xs text-gray-500 font-medium" x-text="`${checklistItems.filter(i => i.is_completed).length}/${checklistItems.length}`"></span>
                </div>

                {# Progress Bar #}
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4" x-show="checklistItems.length > 0">
                    <div class="bg-indigo-500 h-2 rounded-full transition-all duration-300"
                         :style="`width: ${checklistItems.length > 0 ? (checklistItems.filter(i => i.is_completed).length / checklistItems.length) * 100 : 0}%`">
                    </div>
                </div>

                {# Items List #}
                <div class="space-y-2 mb-3">
                    <template x-for="item in checklistItems" :key="item.id">
                        <div class="flex items-start gap-3 group hover:bg-gray-50 p-2 rounded-md transition-colors border border-transparent hover:border-gray-100">
                            <input 
                                type="checkbox" 
                                x-model="item.is_completed"
                                @change="fetch(`/board/checklist/${item.id}/update/`, { method: 'POST', headers: { 'X-CSRFToken': '{{ csrf_token }}', 'Content-Type': 'application/json' }, body: JSON.stringify({ is_completed: item.is_completed }) })"
                                class="mt-1 w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 cursor-pointer"
                            >
                            <span x-text="item.content" class="text-sm flex-1 break-words transition-all" :class="item.is_completed ? 'text-gray-400 line-through' : 'text-gray-700'"></span>
                            <button type="button" class="text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"
                                    @click="if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) { fetch(`/board/checklist/${item.id}/delete/`, { method: 'POST', headers: { 'X-CSRFToken': '{{ csrf_token }}' } }).then(res => res.json()).then(data => { if(data.success) { checklistItems = checklistItems.filter(i => i.id !== item.id); } }) }">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                    </template>
                </div>

                {# Add Item Input #}
                <div class="flex gap-2">
                    <input 
                        type="text" x-model="newChecklistItem" 
                        @keydown.enter.prevent="if(newChecklistItem.trim()) { fetch(`/board/task/${taskId}/checklist/create/`, { method: 'POST', headers: { 'X-CSRFToken': '{{ csrf_token }}', 'Content-Type': 'application/json' }, body: JSON.stringify({ content: newChecklistItem }) }).then(res=>res.json()).then(data => { if(data.success) { checklistItems.push({ id: data.id, content: data.content, is_completed: data.is_completed }); newChecklistItem = ''; } }) }"
                        class="flex-1 text-sm border-gray-300 rounded-md px-3 py-2 bg-gray-50 focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                        placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢..."
                    >
                    <button type="button" 
                            @click="if(newChecklistItem.trim()) { fetch(`/board/task/${taskId}/checklist/create/`, { method: 'POST', headers: { 'X-CSRFToken': '{{ csrf_token }}', 'Content-Type': 'application/json' }, body: JSON.stringify({ content: newChecklistItem }) }).then(res=>res.json()).then(data => { if(data.success) { checklistItems.push({ id: data.id, content: data.content, is_completed: data.is_completed }); newChecklistItem = ''; } }) }"
                            class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-sm font-medium transition-colors">
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°
                    </button>
                </div>
            </div>

            {# --- 4. ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö (Attachments) - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô Edit --- #}
            <div x-show="taskMode === 'edit'">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-indigo-500 text-lg">üìé</span>
                    <h4 class="font-bold text-gray-800 text-sm uppercase tracking-wide">‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</h4>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                    <template x-for="file in attachmentItems" :key="file.id">
                        <div class="group relative flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-lg hover:shadow-sm transition-all">
                            <div class="shrink-0 w-10 h-10 rounded bg-gray-100 flex items-center justify-center overflow-hidden">
                                <template x-if="file.is_image"><img :src="file.url" class="w-full h-full object-cover" /></template>
                                <template x-if="!file.is_image"><span class="text-gray-500 text-[10px] font-bold">FILE</span></template>
                            </div>
                            <div class="min-w-0 flex-1">
                                <a :href="file.url" target="_blank" class="block text-sm font-medium text-gray-700 truncate hover:text-indigo-600" x-text="file.filename"></a>
                                <p class="text-[10px] text-gray-400" x-text="file.uploaded_at"></p>
                            </div>
                            <button type="button" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"
                                    @click="if(confirm('‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?')) { fetch(`/board/attachment/${file.id}/delete/`, { method: 'POST', headers: { 'X-CSRFToken': '{{ csrf_token }}' } }).then(res => res.json()).then(data => { if(data.success) { attachmentItems = attachmentItems.filter(f => f.id !== file.id); } }) }">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                    </template>
                </div>

                <label class="cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-gray-50 hover:bg-gray-100 border border-dashed border-gray-300 text-gray-600 text-sm font-medium rounded-md transition-colors w-full justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                    <span>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå...</span>
                    <input type="file" class="hidden" @change="if($event.target.files.length > 0) { const formData = new FormData(); formData.append('file', $event.target.files[0]); fetch(`/board/task/${taskId}/attachment/create/`, { method: 'POST', headers: { 'X-CSRFToken': '{{ csrf_token }}' }, body: formData }).then(res => res.json()).then(data => { if(data.success) { attachmentItems.unshift({ id: data.id, filename: data.filename, url: data.url, is_image: data.is_image, uploaded_at: data.uploaded_at }); } $event.target.value = ''; }) }">
                </label>
            </div>

            {# --- 5. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Settings Grid) --- #}
            <div>
                <div class="flex items-center gap-2 mb-2 border-t border-gray-100 pt-6">
                    <span class="text-indigo-500 text-lg">‚öôÔ∏è</span>
                    <h4 class="font-bold text-gray-800 text-sm uppercase tracking-wide">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h4>
                </div>
                
                <div class="bg-gray-50 rounded-xl p-4 border border-gray-100 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {# Assigned To #}
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
                        <select name="assigned_to" x-model="taskAssignedTo" class="block w-full text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">-- ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ --</option>
                            {% for u in users %}
                            <option value="{{ u.id }}">{{ u.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {# Priority #}
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label>
                        <select name="priority" x-model="taskPriority" class="block w-full text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            {% for value, label in priority_choices %}
                            <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {# Due Date #}
                    <div class="sm:col-span-2">
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á</label>
                        <input type="datetime-local" name="due_date" x-model="taskDueDate" class="block w-full text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-600"/>
                    </div>
                </div>
            </div>

           {# --- 6. ‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö (Labels) --- #}
            <div class="space-y-2 pt-4 border-t border-gray-100" x-data="{ showCreateLabel: false, newLabelName: '', newLabelColor: 'bg-blue-500' }">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <span class="text-indigo-500 text-lg">üè∑Ô∏è</span>
                        <h4 class="font-bold text-gray-800 text-sm uppercase tracking-wide">‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö</h4>
                    </div>
                    <button type="button" @click="showCreateLabel = !showCreateLabel" class="text-xs text-indigo-600 hover:text-indigo-800 font-medium bg-indigo-50 px-2 py-1 rounded hover:bg-indigo-100 transition-colors">
                        <span x-text="showCreateLabel ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : '+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà'"></span>
                    </button>
                </div>

                {# Create Label UI #}
                <div x-show="showCreateLabel" class="bg-gray-50 p-3 rounded-lg border border-gray-200 space-y-3">
                    <input type="text" x-model="newLabelName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≤‡∏¢..." class="w-full text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    
                    <div class="text-xs text-gray-500 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ:</div>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="color in ['bg-red-500', 'bg-orange-500', 'bg-yellow-400', 'bg-green-500', 'bg-blue-500', 'bg-indigo-500', 'bg-pink-500', 'bg-gray-500']">
                            <button 
                                type="button" 
                                @click="newLabelColor = color" 
                                class="w-6 h-6 rounded-full border border-white shadow-sm hover:scale-110 transition-all"
                                :class="[color, newLabelColor === color ? 'ring-2 ring-offset-1 ring-gray-400 scale-110' : '']"
                            ></button>
                        </template>
                    </div>

                    {# Preview ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡πâ‡∏≤‡∏¢ #}
                    <div class="flex items-center gap-2 p-2 bg-white rounded border border-gray-100">
                        <span class="text-xs text-gray-400">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</span>
                        <div class="px-3 py-1 rounded-full text-xs font-medium text-white shadow-sm transition-all"
                             :class="newLabelColor">
                            <span x-text="newLabelName || '‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö'"></span>
                        </div>
                    </div>

                    <button type="button" @click="if(newLabelName) { fetch('{% url 'create_label' board.id %}', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' }, body: JSON.stringify({ name: newLabelName, color: newLabelColor }) }).then(res=>res.json()).then(data=>{ if(data.success){ const container=document.getElementById('label-container'); const html=`<label class='cursor-pointer relative group'><input type='checkbox' name='labels' value='${data.id}' class='peer sr-only' checked><div class='px-3 py-1 rounded-full text-xs font-medium text-white transition-all ${data.color} shadow-sm peer-checked:ring-2 peer-checked:ring-offset-1 peer-checked:ring-gray-400'>${data.name}</div></label>`; container.insertAdjacentHTML('beforeend', html); newLabelName=''; showCreateLabel=false; if(typeof taskLabels!=='undefined') taskLabels.push(data.id); } }) }" class="w-full bg-indigo-600 text-white text-xs font-bold py-1.5 rounded hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡πâ‡∏≤‡∏¢</button>
                </div>

                {# Label List (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà) #}
                <div id="label-container" class="flex flex-wrap gap-2">
                    {% for label in labels %}
                    <label class="cursor-pointer relative group">
                        <input type="checkbox" name="labels" value="{{ label.id }}" class="peer sr-only" x-model="taskLabels">
                        <div class="px-3 py-1 rounded-full text-xs font-medium text-white opacity-40 hover:opacity-100 peer-checked:opacity-100 peer-checked:ring-2 peer-checked:ring-offset-1 peer-checked:ring-gray-400 transition-all {{ label.color }} shadow-sm">
                            {{ label.name }}
                        </div>
                    </label>
                    {% endfor %}
                </div>
            </div>

            {# --- Footer Buttons --- #}
            <div class="pt-6 flex items-center justify-between border-t border-gray-100 mt-8 sticky bottom-0 bg-white pb-2">
                <div class="flex gap-3 w-full">
                    <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-md transition-all">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î
                    </button>
                    <button type="button" @click="taskModalOpen = false" class="flex-1 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition-all">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
            

        {# ========================================== #}
        {# üí¨ ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤: COMMENTS #}
        {# ========================================== #}
        <div class="hidden lg:flex flex-col h-full border-l border-gray-100 pl-6">
            <div class="flex items-center gap-2 mb-4 text-gray-700">
                <span class="text-lg">üí¨</span>
                <h4 class="font-bold text-sm">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</h4>
            </div>

            {# Comment List #}
            <div class="flex-1 overflow-y-auto space-y-4 pr-2 custom-scrollbar bg-gray-50/50 rounded-xl p-3 border border-gray-100 mb-4">
                <div x-show="isLoadingComments" class="text-center py-4 text-gray-400 text-xs">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                <div x-show="!isLoadingComments && comments.length === 0" class="text-center py-4 text-gray-400 text-xs">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</div>

                <template x-for="comment in comments" :key="comment.id">
                    <div class="flex gap-3 text-sm">
                        <div class="shrink-0 w-8 h-8 rounded-full bg-gray-200 overflow-hidden">
                            <template x-if="comment.author_avatar"><img :src="comment.author_avatar" class="w-full h-full object-cover" /></template>
                            <template x-if="!comment.author_avatar"><div class="w-full h-full flex items-center justify-center bg-indigo-500 text-white text-[10px] font-bold" x-text="comment.author.charAt(0).toUpperCase()"></div></template>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-baseline justify-between mb-1">
                                <span class="font-bold text-gray-800 text-xs" x-text="comment.author"></span>
                                <span class="text-[10px] text-gray-400" x-text="comment.created_at"></span>
                            </div>
                            <div class="bg-white p-2 rounded-lg border border-gray-200 shadow-sm text-gray-600 break-words" x-text="comment.content"></div>
                        </div>
                    </div>
                </template>
            </div>

            {# Input Comment #}
            <div class="mt-auto pt-2" x-show="taskMode === 'edit'">
                <div class="relative">
                    <input 
                        type="text" x-model="newCommentText" @keydown.enter.prevent="postComment()"
                        class="w-full text-sm border-gray-300 rounded-full shadow-sm focus:border-indigo-500 focus:ring-indigo-500 pr-10 py-2"
                        placeholder="‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô..."
                    >
                    <button @click="postComment()" class="absolute right-2 top-1.5 text-indigo-600 hover:text-indigo-800 p-1 rounded-full hover:bg-indigo-50 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
                    </button>
                </div>
                <div class="text-[10px] text-gray-400 mt-1 text-right">‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á</div>
            </div>
            
            <div x-show="taskMode === 'create'" class="mt-auto text-center text-xs text-gray-400 py-4 bg-gray-50 rounded-lg border border-dashed border-gray-200">
                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô<br>‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡πÑ‡∏î‡πâ
            </div>
        </div>

      </div>
    </div>
  </div>
</div>